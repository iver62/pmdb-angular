<form [formGroup]="form" class="form">
  <div cdkDropList formArrayName="actors" (cdkDropListDropped)="drop($event)">
    @for (actor of formArray.controls; track actor; let i = $index) {
    <div class="grid grid-cols-12 gap-2" [formGroupName]="i" cdkDrag>

      <!-- Autocomplete acteur -->
      <app-autocomplete class="col-span-4" [control]="actor.get('name')" [label]="'app.actor_name' | translate"
        [personsToExclude]="formArray?.value | pluck: 'id'" [toSave]="actor?.value?.name && !actor?.value?.id"
        (select)="selectActor($event, i)" (save)="saveActor($event, i)">
      </app-autocomplete>

      <!-- Champ rôle -->
      <mat-form-field class="col-span-6">
        <mat-label>{{'app.role' | translate}}</mat-label>
        <input matInput formControlName="role" />
        @if (actor.value.role) {
        <button matSuffix mat-icon-button class="mr-2" [matTooltip]="'app.erase' | translate"
          aria-label="Effacer le rôle" (click)="clearRole(i)">
          <mat-icon>close</mat-icon>
        </button>
        }
      </mat-form-field>

      <!-- Actions -->
      <div class="flex items-center justify-between pb-4 col-span-2">
        <mat-icon class="cursor-pointer large-icon material-symbols-outlined mx-2"
          [matTooltip]="'app.delete' | translate" (click)="removeActor(i)">
          delete
        </mat-icon>
        <mat-icon class=" cursor-pointer large-icon mr-4" [matTooltip]="'app.move' | translate" cdkDragHandle>
          drag_indicator
        </mat-icon>
      </div>
    </div>
    }
  </div>
  <button mat-button class="mb-2" aria-label="Example icon button with a delete icon" (click)="addActor()">
    {{'app.add_actor' | translate}}
  </button>
</form>