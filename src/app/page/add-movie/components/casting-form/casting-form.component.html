<form [formGroup]="form">
  <div formArrayName="actors">
    @for (control of formArray.controls; track $index; let i = $index) {
    <div class="grid grid-cols-12 gap-2" [formGroupName]="i">

      <!-- Autocomplete acteur -->
      <app-autocomplete class="col-span-4" [control]="control.get('name')" label="Nom de l'acteur"
        [personsToExclude]="formArray?.value | pluck: 'id'" [toSave]="control?.value?.name && !control?.value?.id"
        (select)="selectActor($event, i)" (save)="saveActor($event, i)">
      </app-autocomplete>

      <!-- Champ rôle -->
      <mat-form-field class="col-span-6">
        <mat-label>Rôle</mat-label>
        <input matInput formControlName="role" />
        @if (control.value.role) {
        <button matSuffix mat-icon-button matTooltip="Effacer" aria-label="Effacer le rôle" (click)="clearRole(i)">
          <mat-icon>close</mat-icon>
        </button>
        }
      </mat-form-field>

      <!-- Actions -->
      <div class="flex col-span-2">
        <button mat-icon-button matTooltip="Supprimer" aria-label="Example icon button with a delete icon"
          (click)="removeActor(i)">
          <mat-icon>delete</mat-icon>
        </button>
        <div class="flex flex-col">
          @if (i > 0) {
          <button mat-icon-button matTooltip="Monter" aria-label="Example icon button with a delete icon"
            [disabled]="i == 0" (click)="moveUp(i)">
            <mat-icon>keyboard_arrow_up</mat-icon>
          </button>
          }
          @if (i < formArray.length - 1) { <button mat-icon-button matTooltip="Descendre"
            aria-label="Example icon button with a delete icon" [disabled]="i == formArray?.value?.length - 1"
            (click)="moveDown(i)">
            <mat-icon>keyboard_arrow_down</mat-icon>
            </button>
            }
        </div>
      </div>
    </div>
    }
  </div>
  <button mat-button matTooltip="Ajouter" aria-label="Example icon button with a delete icon" (click)="addActor()">
    Ajouter un acteur
  </button>
</form>