<form [formGroup]="form()" class="form">
  <div formArrayName="awards" class="col-span-12">
    @for (award of formArray?.controls; track award; let i = $index) {
    <div class="grid grid-cols-12 gap-2" [formGroupName]="i">
      <!-- Champ cérémonie -->
      <mat-form-field class="col-span-3">
        <mat-label>{{'app.ceremony' | translate}}</mat-label>
        <input appDelayedInput (delayedInput)="onSearch($event)" matInput aria-label="State" [matAutocomplete]="auto"
          formControlName="ceremony">
        <mat-autocomplete #auto="matAutocomplete" (optionSelected)="selectAward($event)">
          @for (ceremony of ceremonies$ | async; track ceremony) {
          <mat-option [value]="ceremony">{{ceremony}}</mat-option>
          }
        </mat-autocomplete>
      </mat-form-field>

      <!-- Champ nom -->
      <mat-form-field class="col-span-3">
        <mat-label>{{'app.name' | translate}}</mat-label>
        <input matInput formControlName="name" />
        @if (award.value.name) {
        <button matSuffix mat-icon-button class="mx-2" [matTooltip]="'app.erase' | translate"
          aria-label="Effacer le nom" (click)="clearName(i)">
          <mat-icon>close</mat-icon>
        </button>
        }
      </mat-form-field>

      <!-- Champ personnes -->
      <app-multiselect class="col-span-3" [control]="getPersonsFormControl(award)" [label]="'app.persons' | translate"
        [placeholder]="'app.add_persons' | translate" [placeholderLabel]="'app.search_person' | translate"
        [noEntriesFoundLabel]="'app.no_persons_found' | translate" [items]="persons$ | async" [total]="totalPersons"
        (update)="updatePersonSearch($event)">
      </app-multiselect>

      <!-- Champ année -->
      <mat-form-field class="col-span-2">
        <mat-label>{{'app.year' | translate}}</mat-label>
        <input matInput type="number" min="0" formControlName="year" />
        @if (award.value.year) {
        <button matSuffix mat-icon-button class="mx-2" [matTooltip]="'app.erase' | translate"
          aria-label="Effacer l'année" (click)="clearYear(i)">
          <mat-icon>close</mat-icon>
        </button>
        }
      </mat-form-field>

      <div class="flex items-center pb-4">
        <mat-icon class="cursor-pointer large-icon material-symbols-outlined col-span-1"
          [matTooltip]="'app.delete' | translate" (click)="removeAward(i)">
          delete
        </mat-icon>
      </div>
    </div>
    }
    <button mat-button class="w-max mb-2" aria-label="Example icon button with a delete icon" (click)="addAward()">
      Ajouter une récompense
    </button>
  </div>
</form>