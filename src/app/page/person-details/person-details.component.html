<div class="flex flex-col h-full gap-4">
  <button mat-button class="w-fit" routerLink="../">Retour à la liste</button>

  @if (!editMode) {
  @if (person()) {
  @let movies = movies$ | async;

  <div class="h-full">
    <app-person-detail [person]="person()" [service]="service" [canDelete]="movies?.length > 0"
      (edit)="editMode = !editMode" (delete)="deletePerson()">
    </app-person-detail>

    <div class="mt-4">
      <div class="flex flex-row justify-between items-center">
        <h2></h2>
        <app-input class="md:w-1/3" label="Films" [total]="total" (change)="onSearch($event)">
        </app-input>
        <app-toolbar [criterias]="['releaseDate', 'genres', 'countries', 'creationDate', 'lastUpdate']"
          [sorts]="sorts$ | async" (filter)="onFilter($event)" (switchView)="onSwitchView($event)"
          (sort)="onSort($event)">
        </app-toolbar>
      </div>
      <!-- Films associés -->
      @if (searchConfig$.value.view == view.CARDS) {
      <div class="h-[calc(100%-76px)] overflow-y-auto" infiniteScroll [scrollWindow]="false"
        [infiniteScrollDistance]="1" (scrolled)="onScroll()">
        <app-movies-list [movies]="movies"></app-movies-list>
      </div>
      } @else {
      <div class="max-h-[calc(100%-132px)] overflow-y-auto">
        <app-movies-table [dataSource]="movies" [sortActive]="searchConfig$.value.sort"
          [sortDirection]="searchConfig$.value.direction" (sort)="onSort($event)">
        </app-movies-table>
      </div>
      @if (movies?.length) {
      <mat-paginator #paginator [pageSizeOptions]="pageSizeOptions" [length]="total"
        [pageSize]="searchConfig$.value.size" [showFirstLastButtons]="true" (page)="onPageChange($event)"
        aria-label="Select page of Movie search results">
      </mat-paginator>
      }
      }
    </div>
  </div>
  }
  } @else {
  <div class="w-full">
    <div class="flex justify-center p-2">
      <app-person-form class="md:w-2/3" [form]="form" (changeImage)="onChangeImage($event)"></app-person-form>
    </div>
    <div class="fixed bottom-5 right-5">
      <button mat-fab class="float-right m-1" matTooltip="Valider" aria-label="Example icon button with a delete icon"
        color="accent" [disabled]="form.invalid" (click)="save()">
        <mat-icon>check</mat-icon>
      </button>
      <button mat-fab class="float-right m-1" matTooltip="Annuler" aria-label="Example icon button with a delete icon"
        color="accent" (click)="cancel()">
        <mat-icon>close</mat-icon>
      </button>
    </div>
  </div>
  }
</div>